## ゲーム制作講座
演算子オーバーロードはコードをスッキリさせるのに効果的である。  

# 演算子オーバーロードとは

int型などの基本型は a + b のように足し算ができる。  
+演算子はbを実引数にもらってint型のオブジェクトを返すaのメンバ関数と見ることができる。  
これを自分で作ったクラスに定義することができる。  

以下のようにクラスを定義する。  

```cpp
class MyClass {
public:
    MyClass(int a, int b) : 
        a(a),
        b(b)
    {}
    int a;
    int b;
};
```

このクラスのインスタンスを

```cpp
MyClass obj1(3,5);
MyClass obj2(9,2);
```

のように作成する。 

これからMyClassのインスタンスobj3を作成し、初期値をobj1とobj2のそれぞれのa,bの和にしたい。  

いままでの知識では
```cpp
MyClass obj3(obj1.a + obj2.a, obj1.b + obj2.b);
```
とするよりほかはなかった。  

やっていることは単純だが、1と2を書き間違えたり、aとbを書き間違えたりとミスがおこりやすい。  
また、privateにしておきたいメンバ変数を外部からアクセスするのは良くない。  
値を取得する関数を作ってもできるがさらにコードが複雑になってしまう。  

ここでMyClassに+演算子を定義することで直感的に
```cpp
MyClass obj3(obj1 + obj2);
```
と表記できる。  

# 書き方

MyClassの+演算子を定義するには次のようにする。
```cpp
MyClass {
public:
    MyClass(int a, int b) : 
        a(a),
        b(b)
    {}
    int a;
    int b;

    MyClass operator+ (const MyClass &o) const {
        return MyClass(a + o.a, b + o.b);
    }
};
```

operatorの前のMyClassは返り値の型をあらわしている。  

operatorの後の+は演算子の種類を表している。  
+のほかにも-*/などの四則演算に使われる演算子のほか、+=や++、()や[]などもある。  
演算子は他にもあるので調べてみるといいだろう。  

その後の()内は引数を表している。  
通常+演算子は引数は1つなので1つのみ設定しconst参照でもらってきている。  

最後のconstは、メンバ変数を変更しないということを明示するものである。  
もちろん無くても問題はないが、普通+演算ではそのクラス自身のメンバ変数を変更することはないと思うのでconstをつけておいた。  

演算子がMyClassのメンバ関数であることを思い出せば容易に理解できるだろう。  

このようにして自作クラスの演算子を定義できる。  
少し関数名にあたる部分が特殊なだけでほとんどは普通のメンバ関数と同様だ。  

# グローバルな関数としての演算子

メンバ関数としての演算子はクラスを先に書く必要がある。  
```cpp
Myclass obj;
obj + 10;
//10 + obj;
//↑コンパイルエラー
```

+演算子は交換法則を成り立たせるように定義したい。  
そこでグローバルな関数としての演算子を定義する。  
```cpp
inline MyClass operator+ (const int &o, const MyClass &t) const {
    return (t + o);
}
```

inlineについて今回説明はしないが、変更が少ないでかつ中身がきわめて単純な関数はヘッダーファイルに直接inlineを付けて書くと高速化できる。  
今回はMyClass::operator+を変更することはありそうだが交換法則を成り立たせないという変更はそうそうないのでinlineを付けておく。  

このように、operator+という名前の関数に二つの引数を指定して普通の関数のように定義してあげることができる。  

# 練習問題

```cpp
class Vector2i {
public:
    Vector2i() {}
    Vector2i(int x, int y) : 
        x(x),
        y(y)
    {
    }
    int x;
    int y;
};
```

このクラスの+演算子と-演算子を定義せよ。  
内容は各要素の+演算子と-演算子をとるようにすること。  
