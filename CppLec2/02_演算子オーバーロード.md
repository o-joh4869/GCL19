## ゲーム制作講座
***
演算子オーバーロードはコードをスッキリさせるのに効果的である。  

# 演算子オーバーロードとは

int型をクラスとしてみたとき、a + b のように足し算ができる。  
+演算子はaから見ると、int型の引数にbを渡してint型の別のオブジェクトを返すメンバ関数としてみることができる。  
これを自分で作ったクラスに定義することができる。 

言葉で概要を話したところでいまいちピンとこないと思うので詳しく見ていこう。

以下のようにクラスを定義したとする。

```cpp
class MyClass {
public:
    MyClass(int a, int b) : 
        a(a),
        b(b)
    {}
    int a;
    int b;
};
```

このクラスのインスタンスを

```cpp
MyClass obj1(3,5);
MyClass obj2(9,2);
```

のように作成した。 

これからMyClassのインスタンスobj3を作成し、初期値をobj1とobj2のそれぞれのa,bの和にしたいとする。  

いままでの知識では
```cpp
MyClass obj3(obj1.a + obj2.a, obj1.b + obj2.b);
```
とするよりほかはなかった。  

やっていることは単純だが、1と2を書き間違えたり、aとbを書き間違えたりとミスがおこりやすい。  
今後何度もこのようなコードを書くことを考えると少し面倒だ。  

ここでMyClassに+演算子を定義することで直感的に
```cpp
MyClass obj3(obj1 + obj2);
```
と表記できる。  

# 書き方

MyClassのメンバ関数である+演算子を定義するには次のようにする。
```cpp
MyClass {
public:
    MyClass(int a, int b) : 
        a(a),
        b(b)
    {}
    int a;
    int b;

    MyClass operator+ (const MyClass &o) const {
        return MyClass(a + o.a, b + o.b);
    }
};
```

operatorの前のMyClassは返り値の型をあらわしている。  

operatorの後の+は演算子の種類を表している。  
+のほかにも-*/などの四則演算に使われる演算子のほか、+=や++、()や[]などもある。  
演算子は他にもあるので調べてみるのもいいだろう。  

その後のconstは、メンバ変数を変更しないということを明示するものである。  
もちろん無くても問題はないが、普通+演算ではそのクラス自身のメンバ変数を変更することはないと思うのでconstをつけておいた。  

最後の()内は引数を表している。  
通常+演算子は引数は1つなので1つのみ設定しconst参照でもらってきている。  

関数の中身は、演算子がMyClassのメンバ関数であることを思い出せば容易に理解できるだろう。  

このようにして自作クラスの演算子を定義できる。  
引数が違えば同じ演算子でも複数設定できるのは他のメンバ関数と変わらない。   

# グローバルな関数としての演算子

クラスのメンバ関数としての演算子はクラスの方を先に書く必要がある。  
```cpp
Myclass obj;
obj + 10;
//10 + obj;
//↑コンパイルエラー
```

しかしたいていの+演算子は交換法則を成り立たせるように定義したい。  
そこでグローバルな関数としての演算子を定義する。  
```cpp
inline MyClass operator+ (const int &o, const MyClass &t) const {
    return (t + o);
}
```

inlineについて今回説明はしないが絶対に変更しないものでかつ中身がきわめて単純な関数はヘッダーファイルに直接inlineを付けて書くと高速化できる場合が多い。  
今回はMyClass::operator+を変更することはありそうだが交換法則を成り立たせないという変更はそうそうないのでinlineを付けておく。  

このように、operator+という名前の関数に二つの引数を指定して普通の関数のように定義してあげることができる。  

# 練習問題

```cpp
class Vector2i {
public:
    Vector2i() {}
    Vector2i(int x, int y) : 
        x(x),
        y(y)
    {
    }
    int x;
    int y;
};
```

このクラスの+演算子と-演算子を定義せよ。  
内容は各要素の+演算子と-演算子をとるようにすること。  
