## ゲーム制作講座
***
ゲーム上での大まかな処理の流れについて紹介する。

# メインループ

ゲームに限らずコンピューター上で動く絵を表現する方法として、パラパラ漫画のように静止画を短い時間で何回も切り替えて行われている。  
その一枚一枚の間に行われる処理をwhile文の中に書いていくことでゲームになる。  
while文などで表されるこの繰り返しをメインループという。  
また、その一枚一枚をフレームという。  

メインループ内の基本的な処理の流れを示す。  

```cpp
while(true) {
    inputUpdate(); //入力情報の更新
    update(); //入力情報に応じて値を変更
    draw(); //updateされた値に応じて描画
    wait(); //次のフレームまでの時間だけ待つ
}
```

基本的にゲームはプレイヤーが操作し、それに応じて画面が変わっていく。  

操作した情報がキーボードやマウスなどを通じて取り込まれる。  
基本的に操作した情報はフレームの最初に一括して更新され、それに応じて値を変更していく。  
一括して更新する理由として、1フレームの処理中に入力情報が変化してしまう可能性があるというものがある。  
60フレーム毎秒のゲームでは1フレーム16.7msなので現実的な問題だ。  
また、入力情報を取得する処理がけして無視できるほど軽くないというのも大きい。  
そんな理由から入力情報は最初に一括して取得、保存する。  

こうして更新された入力情報に従ってプレーヤーの位置を表す変数の値などを変更していく。  
何も操作しなくても勝手に移動していくもの(敵など)がいると思うが、時間も入力情報として取得していれば一括して扱える。  
時間情報の管理についてはおまけの回で詳しく扱う。  

そして値の更新が完了したらそれに応じて描画処理を行う。  

描画されたら1フレームの処理は終わったように見えるが、このままではマシンが常に計算をし続けるためあまりよくない。  
そこでマシンを休ませるために少しの時間待つという処理が必要である。  
マシン性能でフレームレートが異なってしまうのも問題であるため、処理にかかった時間からフレームレートを固定するようにしている場合がほとんどである。  
DxLibでは、ScreenFlip関数が描画とともに勝手にディスプレイのリフレッシュレートに合わせてフレームレートを固定してくれている。  

# まとめ

今回は基本的な構造と用語の紹介が多かった。  
今後具体的な部分について紹介していく。  
ソースコードとしてMain.cppにDxLibを使う上でのひな形を用意した。  